@startuml
skinparam style strictuml
skinparam MaxMessageSize 200

participant "Cloud Scheduler" as Scheduler
box "FRLineAgent" #f9f9f9
    participant Routing
    participant "Data Provider" as Sheets
    participant "Line Client" as Client
end box
database "Google Sheets" as GSheets
participant "LINE Platform" as LINE
actor User

== Scheduled Execution ==

Scheduler -> Routing: POST /internal/push-trigger (OIDC Auth)

alt #LightPink Auth Error
    Routing --> Scheduler: 401 Unauthorized
end

Routing -> Sheets: Fetch sheet data
Sheets -> GSheets: Google Sheets API Call
GSheets --> Sheets: Return Data

alt #LightPink Data / Sheets API Error
    Sheets --> Routing: Error / Empty
    Routing --> Scheduler: 500 Internal Server Error
end

Sheets --> Routing: Raw Data
Routing -> Routing: Parse & Extract Notification Data

== LINE API Interaction ==

Routing -> Client: Call Push Message API
Client -> LINE: POST /v2/bot/message/push

alt #LightPink LINE API Error (4xx/5xx)
    LINE --> Client: Error Response
    Client -> Client: Log Detail
    Client --> Routing: Throw Exception
    Routing --> Scheduler: 500 Internal Server Error
else #LightBlue Success Path
    LINE --> Client: 200 OK
    Client --> Routing: Success
    Routing --> Scheduler: 200 OK
    LINE --> User: Deliver Message
end

@enduml
